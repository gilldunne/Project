<!DOCTYPE html>
{% load staticfiles %}
<html>
	<head>
		<title>BuilJobUsage</title>
        <link rel="stylesheet" type="text/css" href="{% static '/static/customCSS/style.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static '/static/css/base/core.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static '/static/css/base/components/header.css' %}">
		<script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<meta charset="utf-8">
		
	
	</head>
	<body>
	
		<div id="container" > 
			<div class="lotusui30">

                <div class="lotusBanner"></div>

                <div class="lotusTitleBar2">
                    <div class="lotusInner">
                        <img src="/static/customImages/ibmLogoBlack30.png">
                    </div>
                </div>

                <div class="navContainer">
                    <div class="lotusMenu">
                        <div class="lotusMenuSection">
                            <h1 class="lotusHeading"> <a href="buildjobs" class ="button">By Team </a></h1>
                        </div>
                        <div class="lotusTwistyOpenMenu">
                            <ul>
                                <li><a href="#.html" class ="button">Connections Team</a></li>
                                <ul class="lotusMenuSubsection">
                                    <li><a href="#.html" class ="button">Connections</a></li>
                                    <li><a href="#.html" class ="button">Social Contacts</a></li>
                                </ul>
                                <li><a href="#.html" class ="button">Cloud Platfrom Team</a></li>
                                <ul class="lotusMenuSubsection">
                                    <li><a href="#.html" class ="button">BSS Core</a></li>
                                    <li><a href="#.html" class ="button">BSS UI</a></li>
                                </ul>
                                <li><a href="#.html" class ="button">IBM Docs Team</a></li>
                                <ul class="lotusMenuSubsection">
                                    <li><a href="#.html" class ="button">Docs Editor</a></li>
                                    <li><a href="#.html" class ="button">Docs Viewer</a></li>
                                </ul>
                                <li><a href="#.html" class ="button">Sametime Team</a></li>
                                <ul class="lotusMenuSubsection">
                                    <li><a href="#.html" class ="button">WebChat</a></li>
                                    <li><a href="#.html" class ="button">Sametime</a></li>
                                    <li><a href="#.html" class ="button">Sametime PC Audio</a></li>
                                    <li><a href="#.html" class ="button">Sametime Meetings</a></li>
                                </ul>
                                <li><a href="#.html" class ="button">Unyte Team</a></li>
                                <ul class="lotusMenuSubsection">
                                    <li><a href="#.html" class ="button">Unyte Meetings</a></li>
                                    <li><a href="#.html" class ="button">Unyte Events</a></li>
                                </ul>
                                <li><a href="#.html" class ="button">Foundations Team</a></li>
                                <ul class="lotusMenuSubsection">
                                    <li><a href="#.html" class ="button">Foundations</a></li>
                                </ul>
                            </ul>
                        </div> <!-- lotusTwistyOpenMenu end -->
                    </div>
                </div>
			
			<div class="mainContainer">
			<h3>Buildjobs Usage per SubTeam</h3>
				<div class="chart"></div>

                <script>
                    datasetCount = [];
                    var getRequest = function(callbackResponse) {
                        $.ajax({
                            type: "GET",
                            url: "/api/get_build_job_usage_sub_teams",
                            cache: false,
                            success: function (response) {
                                console.log(response);
                                callbackResponse(response);
                            }
                        });
                    };
                    var callbackResponse = function(response) {
                        pieUsage(
                                $.each(response, function(i, val){
                                    datasetCount[i]=val.count;
                                    console.log(datasetCount[i]);
                         }));

{#                        dashboard('#dashboard', response);#}
                    }
                </script>

                <script>
                    function pieUsage(dataset){
					var w = 450;
					var h = 400;
					var labelArea = 150;
					var colours = ["#99C2EB", "#0066CC", "#337DC6"];
					var color = d3.scale.category20();
					var outerRadius = (w - labelArea) / 2;
					var innerRadius = 0;
					var arc = d3.svg.arc()
						.innerRadius(innerRadius)
						.outerRadius(outerRadius);
					var pie = d3.layout.pie();
					//Create SVG element
					var svg = d3.select(".chart")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

					//Set up groups
					var arcs = svg.selectAll("g.arc")
						.data(pie(datasetCount))
						.enter()
						.append("g")
						.attr("class", "arc")
						.attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

					//Draw arc paths
					arcs.append("path")
						.attr("fill", function(d, i) {
							return color(i);
						})
						.attr("d", arc);
						
					arcs.append("path")
						.attr("fill", function(d, i) { return color(i);})
						.attr("d", arc)
						.on("mouseover", function(d){
							d3.select(this)
							.attr("fill", "#64707D");
						})
						.on("mouseout", function(d, i) {
							d3.select(this)
                            .attr("fill", color(i));
						});
					//Labels
					arcs.append("text")
					    .attr("transform", function(d) {
					        return "translate(" + arc.centroid(d) + ")";
					    })
					    .attr("text-anchor", "middle")
					    .text(function(d) {
					        return d.value;
					    });
					
					var legend = svg.selectAll(".legend")
						.data(dataset)
						.enter()
						.append("g")
						.attr("class", "legend")
						.attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

					legend.append("rect")
						.attr("x", w-18)
						.attr("width", 15)
						.attr("height",15)
						.style("fill", function(d,i){
							return color(i);
						});

					legend.append("text")
						.attr("x", w - 24)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "end")
						.text(function (d) { return d.status; });
                        }
				</script>

                <script>

                    $( document ).ready(function() {
                        getRequest(callbackResponse);
                    });
                </script>
			</div>
		</div>
	</body>
</html>