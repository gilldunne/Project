<!DOCTYPE html>
{% load staticfiles %}
<html>
	<head>
		<title>BuilJobs</title>
        <link rel="stylesheet" type="text/css" href="{% static '/static/css/base/core.css' %}">
		<link rel="stylesheet" type="text/css" href="{% static '/static/customCSS/style.css' %}">
		<script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
		<meta charset="utf-8">
		
	
	</head>
	<body>
	
		<div id="container" > 
			<div id="header"> <center>This is the IBM header from Dashboard</center></div>
			
{#			<div id="sidebar"> #}
{#				<ul id="sidebar">#}
{#					<li><a href="index.html" class ="button">Home</a></li>	#}
{#					<li><a href="graph1.html" class ="button">Graph 1</a></li>#}
{#					<li><a href="graph2.html" class ="button">Graph 2</a></li>#}
{#					<li><a href="graph3.html" class ="button">Graph 3</a></li>#}
{#					<li><a href="graph4.html" class ="button">Graph 4</a></li>#}
{#				</ul>#}
{#			</div>#}
			
			<div id="content"> 
			<h3>Buildjobs Usage per SubTeam</h3>
				<div class="chart"></div>

                <script>
                    datasetCount = [];
                    var getRequest = function(callbackResponse) {
                        $.ajax({
                            type: "GET",
                            url: "/api/get_build_job_usage_sub_teams",
                            cache: false,
                            success: function (response) {
                                console.log(response);
                                callbackResponse(response);
                            }
                        });
                    };
                    var callbackResponse = function(response) {
                        pieUsage(
                                $.each(response, function(i, val){
                                    datasetCount[i]=val.count;
                                    console.log(datasetCount[i]);
                         }));

{#                        dashboard('#dashboard', response);#}
                    }
                </script>
{#                <script>#}
{#					var dataset = [#}
{#						{status: "Testing", count: 4},#}
{#						{status: "Development", count: 6},#}
{#						{status: "Performance", count: 3}#}
{#					];#}
{#                   #}
{#                </script>#}

                <script>
                    function pieUsage(dataset){
					var w = 450;
					var h = 400;
					var labelArea = 150;

{#					var datasetCount = [ 4, 6, 3 ];#}
					var colours = ["#99C2EB", "#0066CC", "#337DC6"];
					var color = d3.scale.category20();
					var outerRadius = (w - labelArea) / 2;
					var innerRadius = 0;
					var arc = d3.svg.arc()
						.innerRadius(innerRadius)
						.outerRadius(outerRadius);

					var pie = d3.layout.pie();

					//Easy colors accessible via a 10-step ordinal scale


					//Create SVG element
					var svg = d3.select(".chart")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

					//Set up groups
					var arcs = svg.selectAll("g.arc")
						.data(pie(datasetCount))
						.enter()
						.append("g")
						.attr("class", "arc")
						.attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

					//Draw arc paths
					arcs.append("path")
						.attr("fill", function(d, i) {
							return color(i);
						})
						.attr("d", arc);
						
					arcs.append("path")
						.attr("fill", function(d, i) { return color(i);})
						.attr("d", arc)
						.on("mouseover", function(d){
							d3.select(this)
							.attr("fill", "#64707D");
						})
						.on("mouseout", function(d, i) {
							d3.select(this)
                            .attr("fill", color(i));
						});
					//Labels
					arcs.append("text")
					    .attr("transform", function(d) {
					        return "translate(" + arc.centroid(d) + ")";
					    })
					    .attr("text-anchor", "middle")
					    .text(function(d) {
					        return d.value;
					    });
					
					var legend = svg.selectAll(".legend")
						.data(dataset)
						.enter()
						.append("g")
						.attr("class", "legend")
						.attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

					legend.append("rect")
						.attr("x", w-18)
						.attr("width", 15)
						.attr("height",15)
						.style("fill", function(d,i){
							return color(i);
						});

					legend.append("text")
						.attr("x", w - 24)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "end")
						.text(function (d) { return d.status; });
                        }
				</script>

                <script>

                    $( document ).ready(function() {
                        getRequest(callbackResponse);
                    });
                </script>
			</div>
		</div>
	</body>
</html>